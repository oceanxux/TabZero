name: Chrome 

on:
  push:
    branches:
      - main # 只有推送到 main 分支时才触发自动构建
  workflow_dispatch: # 允许你手动在 GitHub 页面上运行此工作流

jobs:
  build:
    runs-on: ubuntu-latest # 使用最新的 Ubuntu 虚拟机环境

    steps:
      - name: 1. Checkout code
        uses: actions/checkout@v4 # 检出代码到工作区

      - name: 2. Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # 确保使用符合 Vite 要求的 Node.js 版本

      - name: 3. Install dependencies (npm install)
        # 使用 --legacy-peer-deps 或 --force 避免某些 React/ESLint 插件的 peer dependency 报错
        run: npm install --legacy-peer-deps

      - name: 4. Run Build Command (tsc & vite build)
        # 这会运行你的 "tsc -b && vite build && npm run copy-manifest"
        run: npm run build
        
      - name: 5. Archive Production Artifact (ZIP)
        # 将最终的打包文件夹 TabZero 压缩成 zip，方便下载和上传到 Web Store
        # (假设你的输出文件夹是 TabZero)
        run: zip -r tabzero-release.zip TabZero/

      - name: 6. Upload Build Artifact
        uses: actions/upload-artifact@v4 # 将 zip 文件上传到 GitHub Actions 的存储空间
        with:
          name: tabzero-extension-build
          path: tabzero-release.zip
          retention-days: 7 # 保留构建产物 7 天